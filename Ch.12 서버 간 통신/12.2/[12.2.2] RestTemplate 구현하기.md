![header](https://capsule-render.vercel.app/api?type=wave&color=C3E5AE&height=200&section=header&text=Spring&nbsp;Boot&nbsp;Study&fontSize=50&fontColor=000000)

## [12.2.2] RestTemplate êµ¬í˜„í•˜ê¸°
* ì¼ë°˜ì ìœ¼ë¡œ RestTemplate ì€ ë³„ë„ì˜ ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë¡œ ìƒì„±í•˜ê±°ë‚˜ ì„œë¹„ìŠ¤ ë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì¸µì—ì„œ êµ¬í˜„ëœë‹¤.     


:bulb: ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ëŠ” ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œì™€ ë³€ìˆ˜ë¥¼ ì œê³µí•˜ì§€ ì¼ì ˆ ì œê³µí•˜ì§€ ì•Šê³  ì •ì  ë©”ì„œë“œì™€ ë³€ìˆ˜ë§Œì„ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì´ì•¼ê¸° í•œë‹¤.  


#### â˜‘ï¸ ì„œë²„ ê°„ í†µì‹  êµ¬ì¡° 
![image](https://user-images.githubusercontent.com/78422940/232410712-c5bee9b5-50ff-47b0-a8e8-323ac9c60b5d.png)
* í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ë¥¼ ëŒ€ìƒìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ëŠ” ì—­í• 
* 12.2.1 ì ˆì—ì„œ êµ¬í˜„í•œ ServerBox í”„ë¡œì íŠ¸ëŠ” ì„œë²„ 2ì˜ ì—­í• ì„ ë‹´ë‹¹ 
* ì„œë²„ 1ì€ ì„œë²„2ì— ìš”ì²­ì„ ë‚ ë¦¬ê¸° ìœ„í•´ **ì„œë²„ì˜ ì—­í• ì„ ìˆ˜í–‰**í•˜ë©´ì„œ **ë‹¤ë¥¸ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í• ë„ ìˆ˜í–‰**

### ğŸ“— GET í˜•ì‹ì˜ RestTemplate ì‘ì„±í•˜ê¸°
##

> **[ì˜ˆì œ 12.3]**
```java
@Service
public class RestTemplateService {
    // ì˜ˆì œ 12.3
    public String getName() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api")
            .encode()
            .build()
            .toUri();
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        return responseEntity.getBody();
    }
    public String getNameWithPathVariable() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api/{name}")
            .encode()
            .build()
            .expand("Flature") // ë³µìˆ˜ì˜ ê°’ì„ ë„£ì–´ì•¼í•  ê²½ìš° , ë¥¼ ì¶”ê°€í•˜ì—¬ êµ¬ë¶„
            .toUri();
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        return responseEntity.getBody();
    }
    public String getNameWithParameter() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api/param")
            .queryParam("name", "Flature")
            .encode()
            .build()
            .toUri();
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        return responseEntity.getBody();
    }
  }
```
* RestTemplateë¥¼ ìƒì„±í•˜ê³  ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ì•„ì£¼ ë‹¤ì–‘í•˜ì§€ë§Œ, **ê°€ì¥ ë³´í¸ì ì¸ ë°©ë²•ì€ UriComponentsBuilderë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•**     


:white_check_mark: UriComponentsBuilderëŠ” ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ë¡œì„œ, **ì—¬ëŸ¬ íŒŒë¼ë¯¸í„°ë¥¼ ì—°ê²°í•´ì„œ URI í˜•ì‹ìœ¼ë¡œ ë§Œë“œëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰**

> **getName()** - íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í˜¸ì¶œ ë°©ë²•
```java
public String getName() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api")
            .encode()
            .build()
            .toUri();
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        return responseEntity.getBody();
    }
```
:one: **UriComponentsBuilder** ëŠ” **ë¹Œë” í˜•ì‹ìœ¼ë¡œ ê°ì²´ë¥¼ ìƒì„±**  

:two: **fromUriString() ë©”ì„œë“œ**ì—ëŠ” í˜¸ì¶œë¶€ì˜ URL ì„ ì…ë ¥  

:three: **path() ë©”ì„œë“œ**ì— ì„¸ë¶€ ê²½ë¡œë¥¼ ì…ë ¥í•´ì¤€ë‹¤.  

:four: **encode() ë©”ì„œë“œ**ëŠ” ì¸ì½”ë”© ë¬¸ìì…‹ì„ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ë°, ì¸ìë¥¼ ì „ë‹¬í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ UTF-8 ë¡œ ì„¤ì •ëœë‹¤.  

:five: **build() ë©”ì„œë“œ** ë¥¼ í†µí•´ ë¹Œë” ìƒì„±ì„ ì¢…ë£Œí•˜ê³  UriComponents íƒ€ì…ì´ ë¦¬í„´ ëœë‹¤.

:six: **toUri() ë©”ì„œë“œ**ë¥¼ í†µí•´ URI íƒ€ì…ìœ¼ë¡œ ë¦¬í„´ë°›ì„ ìˆ˜ ìˆê³ , URI ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  String íƒ€ì…ì˜ URIë¥¼ ì‚¬ìš©í•œë‹¤ë©´ **toUriString() ë©”ì„œë“œë¡œ ëŒ€ì²´í•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.**   

âœ”ï¸ ì´ë ‡ê²Œ ìƒì„±ëœ uri ëŠ” restTemplateì´ ì™¸ë¶€ APIë¥¼ ìš”ì²­í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, getForEntity()ì— íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœë‹¤. getForEntity() ëŠ” URI ì™€ ì‘ë‹µë°›ëŠ” íƒ€ì…ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ì‚¬ìš©í•œë‹¤.   

> **getNameWithPathVariable()** - PathVariableë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
```java
public String getNameWithPathVariable() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api/{name}")
            .encode()
            .build()
            .expand("Flature") // ë³µìˆ˜ì˜ ê°’ì„ ë„£ì–´ì•¼í•  ê²½ìš° , ë¥¼ ì¶”ê°€í•˜ì—¬ êµ¬ë¶„
            .toUri();
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        return responseEntity.getBody();
    }
```
:one: **path() ë©”ì„œë“œ** ë‚´ì— ì…ë ¥í•œ ì„¸ë¶€ URI ì¤‘ ì¤‘ê´„í˜¸({}) ë¶€ë¶„ì„ ì‚¬ìš©í•´ **ê°œë°œ ë‹¨ê³„ì—ì„œ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆëŠ” ë³€ìˆ˜ëª…ì„ ì…ë ¥**  
:two: **expand() ë©”ì„œë“œ** ì—ì„œ path() ë©”ì„œë“œ ë‚´ì—ì„œ ì…ë ¥í•œ ë³€ìˆ˜ëª…ì˜ ìˆœì„œëŒ€ë¡œ ê°’ì„ ì…ë ¥í•´ì¤Œ. ê°’ì„ ì—¬ëŸ¬ ê°œ ë„£ì–´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ì½¤ë§ˆë¡œ êµ¬ë¶„í•˜ì—¬ ë‚˜ì—´í•œë‹¤.  

> **getNameWithParameter() - RequestParamì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**
```java
 public String getNameWithParameter() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api/param")
            .queryParam("name", "Flature")
            .encode()
            .build()
            .toUri();
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        return responseEntity.getBody();
    }
```
:one: **queryParam() ë©”ì„œë“œ**ë¥¼ ì‚¬ìš©í•´ (í‚¤, ê°’) í˜•ì‹ìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŒ.
### :green_book: POST í˜•ì‹ì˜ RestTemplate ì‘ì„±
##

> **[ì˜ˆì œ 12.4]**
```java
// ì˜ˆì œ 12.4
    public ResponseEntity<MemberDto> postWithParamAndBody() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api")
            .queryParam("name", "Flature")
            .queryParam("email", "flature@wikibooks.co.kr")
            .queryParam("organization", "Wikibooks")
            .encode()
            .build()
            .toUri();
        MemberDto memberDto = new MemberDto();
        memberDto.setName("flature!!");
        memberDto.setEmail("flature@gmail.com");
        memberDto.setOrganization("Around Hub Studio");
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<MemberDto> responseEntity = restTemplate.postForEntity(uri, memberDto,
            MemberDto.class);
        return responseEntity;
    }
    public ResponseEntity<MemberDto> postWithHeader() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api/add-header")
            .encode()
            .build()
            .toUri();
        MemberDto memberDTO = new MemberDto();
        memberDTO.setName("flature");
        memberDTO.setEmail("flature@wikibooks.co.kr");
        memberDTO.setOrganization("Around Hub Studio");
        RequestEntity<MemberDto> requestEntity = RequestEntity
            .post(uri)
            .header("my-header", "Wikibooks API")
            .body(memberDTO);
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<MemberDto> responseEntity = restTemplate.exchange(requestEntity,
            MemberDto.class);
        return responseEntity;
    }
```  

> **postWithParamAndBody() - ì™¸ë¶€ API ì— ìš”ì²­í•  ë•Œ Body ê°’ê³¼ íŒŒë¼ë¯¸í„° ê°’ì„ ë‹´ìŒ**
```java
public ResponseEntity<MemberDto> postWithParamAndBody() {
        URI uri = UriComponentsBuilder
            .fromUriString("http://localhost:9090")
            .path("/api/v1/crud-api")
            .queryParam("name", "Flature")
            .queryParam("email", "flature@wikibooks.co.kr")
            .queryParam("organization", "Wikibooks")
            .encode()
            .build()
            .toUri();
        MemberDto memberDto = new MemberDto();
        memberDto.setName("flature!!");
        memberDto.setEmail("flature@gmail.com");
        memberDto.setOrganization("Around Hub Studio");
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<MemberDto> responseEntity = restTemplate.postForEntity(uri, memberDto,
            MemberDto.class);
        return responseEntity;
    }
```
:one: **UriComponentsBuilder**ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒë¼ë¯¸í„°ì— ê°’ì„ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

:two: MemeberDto ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ RequestBody ì— ê°’ì„ ë‹´ì•„ì¤€ë‹¤. ë§Œì•½, postForEntity() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ê²½ìš°ì—ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë°ì´í„° ê°ì²´ë¥¼ ë„£ìœ¼ë©´ ëœë‹¤.
    
> **[ì˜ˆì œ 12.6] ì„œë¹„ìŠ¤ ì½”ë“œë¥¼ ì—°ê²°í•˜ëŠ” Controller ì½”ë“œ**
```java
// ì˜ˆì œ 12.6
@RestController
@RequestMapping("/rest-template")
public class RestTemplateController {
    private final RestTemplateService restTemplateService;
    public RestTemplateController(RestTemplateService restTemplateService) {
        this.restTemplateService = restTemplateService;
    }
    @GetMapping
    public String getName() {
        return restTemplateService.getName();
    }
    @GetMapping("/path-variable")
    public String getNameWithPathVariable(){
        return restTemplateService.getNameWithPathVariable();
    }
    @GetMapping("/parameter")
    public String getNameWithParameter(){
        return restTemplateService.getNameWithParameter();
    }
    @PostMapping
    public ResponseEntity<MemberDto> postDto(){
        return restTemplateService.postWithParamAndBody();
    }
    @PostMapping("/header")
    public ResponseEntity<MemberDto> postWithHeader(){
        return restTemplateService.postWithHeader();
    }
}
```
